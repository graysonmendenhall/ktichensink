<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PathMinder - Find Your Way</title>
    
    <link rel="icon" type="image/png" href="imgs/favicon.png" />
    <link rel="stylesheet" href="css/foundation.css" />
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
      <style>
	.columns {
	  padding: 0;
	}
	
	#map-canvas {
	height: 80%;
	width: 100%;
	padding: 0 0 0 0;
	
	}
	
      </style>
      <script src="js/vendor/modernizr.js"></script>
      <script type="text/javascript" src="js/main.js"></script>
      <script src="phonegap.js"></script>
      <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDexT_U6gthKGQI7zXazzOPMZfSgXb-n54"></script>
      <script src="js/map.js"></script>
      
      <script type="text/javascript">
	
	//what are these coordinates doing here?????
	var pos;
	var end;
	
    
var directionsDisplay;
var directionsService = new google.maps.DirectionsService();
var map;

function initialize() {
  directionsDisplay = new google.maps.DirectionsRenderer();
  
  var mapOptions = {
    zoom: 14,
  };
  map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
  

  // Try HTML5 geolocation
  if(navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      pos = new google.maps.LatLng(position.coords.latitude,
                                       position.coords.longitude);
      
      var infowindow = new google.maps.InfoWindow({
        map: map,
        position: pos,
	zoom: 14,
        content: 'You.',
	maxWidth: 300
      });

      map.setCenter(pos);
      
      directionsDisplay.setMap(map);
  console.log(pos);
    }, function() {
      handleNoGeolocation(true);
      
    });
  } else {
    // Browser doesn't support Geolocation
    handleNoGeolocation(false);
  }
  
}


function handleNoGeolocation(errorFlag) {
  if (errorFlag) {
    var content = 'Error: The Geolocation service failed.';
  } else {
    var content = 'Error: Your browser doesn\'t support geolocation.';
  }

  var options = {
    map: map,
    position: new google.maps.LatLng(60, 105),
    content: content
  };

  var infowindow = new google.maps.InfoWindow(options);
  map.setCenter(options.position);
}

function setEnd(value) {
  
  
  var searchString = document.getElementById('end').value;
  console.log(value);
  var commaPos = searchString.indexOf(',');
  
  var coordinatesLat = parseFloat(searchString.substring(0, commaPos));
  var coordinatesLong = parseFloat(searchString.substring(commaPos + 1, searchString.length));
  console.log(coordinatesLat, coordinatesLong);
  var centerPoint = new google.maps.LatLng(coordinatesLat, coordinatesLong);
  console.log(centerPoint);
  
  calcRoute(centerPoint);
  
}

function calcRoute(end) {
  console.log(pos);
  console.log(end);

  var request = {
      origin:pos,
      destination:end,
      travelMode: google.maps.TravelMode.WALKING
  };
  directionsService.route(request, function(response, status) {
    if (status == google.maps.DirectionsStatus.OK) {
      directionsDisplay.setDirections(response);
    }
  });
}

google.maps.event.addDomListener(window, 'load', initialize);
      
    </script>
      
  </head>

  <body style="background-color: #56a0d3; padding: 15px;">
    
    
    
    <div class="row collapse">
     
	<div class="large-12 columns" style="margin-top: 30px;">
	  <img src="imgs/icon_logo.png" alt="" height=100% width=100%>
	</div>
      
    </div>
    
    
    <form>
      <div class="medium-3 columns">
	<hr style="margin-bottom: 30px;">
      </div>
    
    <div class="large-6 columns" style="color: #FFFFFF; text-align: center; font-size: 1.5em; line-height: 1em; margin-bottom: 35px;">Where Do You Need To Go?</div>
    <div class="large-6 columns" >
      <!---<div class="row collapse postfix-round">
        <div class="small-9 columns">
          <input type="text" placeholder="Search for a destination">
        </div>
        <div class="small-3 columns">
          <a href="#" class="button postfix">Go!</a>
        </div>
      </div>--->

    <!---<div class="large-6 columns" style="color: #FFFFFF; text-align: center; font-size: 1em; margin-bottom: 20px;">- OR -</div>--->
    
    <div id="panel" style="height: 40px;">
    <!---<b style="color: #FFFFFF;">Start: </b>
    <select id="start" onchange="calcRoute();">
      <option value="carroll hall, chapel hill, nc">Carroll Hall</option>
      <option value="125 W Franklin Street, Chapel Hill, NC 27514">Granville Towers</option>
      <option value="hanes art center, chapel hill, nc">Hanes Art Center</option>
      <option value="300 Skipper Bowles Drive, Chapel Hill, NC 27514">Dean Smith Center</option>
      <option value="250 E Franklin Street, Chapel Hill, NC 27514">Morehead Planetarium</option>
      <option value="old well, chapel hill, nc">Old Well</option>
    </select>--->
 
    <select id="end" onchange="setEnd(this.value);">
      <option value="">Choose a destination</option>
      <option value="35.910252, -79.047623">Graham Student Union</option>
      <option value="35.906915, -79.047805">Kenan Memorial Stadium</option>
      <option value="35.902722, -79.045123">Craige Residence Hall</option>
      <option value="35.899861, -79.045984">Kenan-Flagler Business School</option>
      <option value="35.903678, -79.050767">UNC Hospitals</option>
      <option value="35.910345, -79.051563">Carroll Hall</option>
      <option value="35.911056, -79.057385">Granville Towers</option>
      <option value="35.912432, -79.054233">Hanes Art Center</option>
      <option value="35.899480, -79.043916">Dean Smith Center</option>
      <option value="35.913920, -79.050547">Morehead Planetarium</option>
      <option value="35.906949, -79.047885">Old Well</option>
    </select>
    </div>
   
    <div id="warnings_panel" style="width:100%;height:10%;text-align:center"></div>
    
        </div>
  </div>
</form>
  
      
    </div>
 </div>
 <div style="margin-top: 180px;"></div>
	<div id="map-canvas" style="height: 400px;"></div>
   
    
    <script src="js/vendor/jquery.js"></script>
    <script src="js/foundation.min.js"></script>
    <script>
      $(document).foundation();
    </script>
   

  
  </body>
</html>
